openapi: 3.0.3
info:
  title: DisplayDeck API
  version: "1.0.0"
servers:
  - url: http://localhost:2001/api
paths:
  /health:
    get:
      summary: Health check
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  value:
                    type: string
                    example: OK

  /auth/login:
    post:
      summary: Login
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AuthLoginRequest'
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthResponse'

  /auth/register:
    post:
      summary: Register
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AuthRegisterRequest'
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthResponse'

  /auth/refresh:
    post:
      summary: Refresh access token
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AuthRefreshRequest'
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthResponse'

  /auth/logout:
    post:
      summary: Logout (revoke refresh token)
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AuthLogoutRequest'
      responses:
        '204':
          description: No Content

  /plans:
    get:
      summary: List plans
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Plan'

  /roles:
    get:
      summary: List roles
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  type: string

  /organizations:
    get:
      summary: List organizations
      security:
        - BearerAuth: []
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  value:
                    type: array
                    items:
                      $ref: '#/components/schemas/Organization'
    post:
      summary: Create organization
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/OrganizationCreate'
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Organization'

  /organizations/{id}:
    get:
      summary: Get organization by id
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Organization'
        '404':
          description: Not found

  /organizations/{OrganizationId}/subscription:
    get:
      summary: Get subscription for organization
      security:
        - BearerAuth: []
      parameters:
        - name: OrganizationId
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Subscription'

  /organizations/{OrganizationId}/api-keys:
    get:
      summary: List API keys for organization
      security:
        - BearerAuth: []
        - ApiKeyAuth: []
      parameters:
        - name: OrganizationId
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/ApiKeyListItem'
    post:
      summary: Create API key for organization
      security:
        - BearerAuth: []
        - ApiKeyAuth: []
      parameters:
        - name: OrganizationId
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ApiKeyCreateRequest'
      responses:
        '201':
          description: Created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiKeyCreateResponse'

  /organizations/{OrganizationId}/api-keys/{ApiKeyId}:
    delete:
      summary: Revoke API key
      security:
        - BearerAuth: []
        - ApiKeyAuth: []
      parameters:
        - name: OrganizationId
          in: path
          required: true
          schema:
            type: integer
        - name: ApiKeyId
          in: path
          required: true
          schema:
            type: integer
            format: int64
      responses:
        '204':
          description: No Content

  /organizations/{OrganizationId}/webhooks:
    get:
      summary: List webhooks for organization
      security:
        - BearerAuth: []
        - ApiKeyAuth: []
      parameters:
        - name: OrganizationId
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Webhook'
    post:
      summary: Create webhook
      security:
        - BearerAuth: []
        - ApiKeyAuth: []
      parameters:
        - name: OrganizationId
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/WebhookCreateRequest'
      responses:
        '201':
          description: Created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/WebhookCreateResponse'

  /organizations/{OrganizationId}/webhooks/{WebhookId}:
    get:
      summary: Get webhook
      security:
        - BearerAuth: []
        - ApiKeyAuth: []
      parameters:
        - name: OrganizationId
          in: path
          required: true
          schema:
            type: integer
        - name: WebhookId
          in: path
          required: true
          schema:
            type: integer
            format: int64
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Webhook'
    delete:
      summary: Delete webhook
      security:
        - BearerAuth: []
        - ApiKeyAuth: []
      parameters:
        - name: OrganizationId
          in: path
          required: true
          schema:
            type: integer
        - name: WebhookId
          in: path
          required: true
          schema:
            type: integer
            format: int64
      responses:
        '204':
          description: No Content

  /organizations/{OrganizationId}/audit-log:
    get:
      summary: List audit log entries
      security:
        - BearerAuth: []
        - ApiKeyAuth: []
      parameters:
        - name: OrganizationId
          in: path
          required: true
          schema:
            type: integer
        - name: limit
          in: query
          required: false
          schema:
            type: integer
            default: 100
            maximum: 200
        - name: beforeId
          in: query
          required: false
          schema:
            type: integer
            format: int64
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuditLogListResponse'

  /organizations/{OrganizationId}/displays:
    get:
      summary: List displays for organization
      security:
        - BearerAuth: []
        - ApiKeyAuth: []
      parameters:
        - name: OrganizationId
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  value:
                    type: array
                    items:
                      $ref: '#/components/schemas/Display'
    post:
      summary: Create display for organization
      security:
        - BearerAuth: []
        - ApiKeyAuth: []
      parameters:
        - name: OrganizationId
          in: path
          required: true
          schema:
            type: integer
        - name: Idempotency-Key
          in: header
          required: false
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/DisplayCreate'
      responses:
        '201':
          description: Created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Display'

  /displays/{Id}:
    get:
      summary: Get display by id
      security:
        - BearerAuth: []
        - ApiKeyAuth: []
      parameters:
        - name: Id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Display'
    put:
      summary: Update display
      security:
        - BearerAuth: []
        - ApiKeyAuth: []
      parameters:
        - name: Id
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Display'
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Display'
    delete:
      summary: Delete display
      security:
        - BearerAuth: []
        - ApiKeyAuth: []
      parameters:
        - name: Id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '204':
          description: No Content

  /organizations/{OrganizationId}/campaigns:
    get:
      summary: List campaigns for organization
      security:
        - BearerAuth: []
        - ApiKeyAuth: []
      parameters:
        - name: OrganizationId
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  value:
                    type: array
                    items:
                      $ref: '#/components/schemas/Campaign'
    post:
      summary: Create campaign for organization
      security:
        - BearerAuth: []
        - ApiKeyAuth: []
      parameters:
        - name: OrganizationId
          in: path
          required: true
          schema:
            type: integer
        - name: Idempotency-Key
          in: header
          required: false
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CampaignCreate'
      responses:
        '201':
          description: Created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Campaign'

  /campaigns/{Id}:
    get:
      summary: Get campaign by id
      security:
        - BearerAuth: []
        - ApiKeyAuth: []
      parameters:
        - name: Id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Campaign'
    put:
      summary: Update campaign
      security:
        - BearerAuth: []
        - ApiKeyAuth: []
      parameters:
        - name: Id
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Campaign'
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Campaign'
    delete:
      summary: Delete campaign
      security:
        - BearerAuth: []
        - ApiKeyAuth: []
      parameters:
        - name: Id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '204':
          description: No Content

  /campaigns/{CampaignId}/items:
    get:
      summary: List items for campaign
      security:
        - BearerAuth: []
        - ApiKeyAuth: []
      parameters:
        - name: CampaignId
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  value:
                    type: array
                    items:
                      $ref: '#/components/schemas/CampaignItem'
    post:
      summary: Create item for campaign
      security:
        - BearerAuth: []
        - ApiKeyAuth: []
      parameters:
        - name: CampaignId
          in: path
          required: true
          schema:
            type: integer
        - name: Idempotency-Key
          in: header
          required: false
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CampaignItemCreate'
      responses:
        '201':
          description: Created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CampaignItem'

  /campaigns/{CampaignId}/schedules:
    get:
      summary: List schedules for campaign
      security:
        - BearerAuth: []
        - ApiKeyAuth: []
      parameters:
        - name: CampaignId
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  value:
                    type: array
                    items:
                      $ref: '#/components/schemas/Schedule'
    post:
      summary: Create schedule for campaign
      security:
        - BearerAuth: []
        - ApiKeyAuth: []
      parameters:
        - name: CampaignId
          in: path
          required: true
          schema:
            type: integer
        - name: Idempotency-Key
          in: header
          required: false
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ScheduleUpsert'
      responses:
        '201':
          description: Created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Schedule'

  /schedules/{Id}:
    get:
      summary: Get schedule by id
      security:
        - BearerAuth: []
        - ApiKeyAuth: []
      parameters:
        - name: Id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Schedule'
    put:
      summary: Update schedule
      security:
        - BearerAuth: []
        - ApiKeyAuth: []
      parameters:
        - name: Id
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ScheduleUpsert'
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Schedule'
    delete:
      summary: Delete schedule
      security:
        - BearerAuth: []
        - ApiKeyAuth: []
      parameters:
        - name: Id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '204':
          description: No Content

  /campaign-items/{Id}:
    get:
      summary: Get campaign item by id
      security:
        - BearerAuth: []
        - ApiKeyAuth: []
      parameters:
        - name: Id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CampaignItem'
    put:
      summary: Update campaign item
      security:
        - BearerAuth: []
        - ApiKeyAuth: []
      parameters:
        - name: Id
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CampaignItem'
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CampaignItem'
    delete:
      summary: Delete campaign item
      security:
        - BearerAuth: []
        - ApiKeyAuth: []
      parameters:
        - name: Id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '204':
          description: No Content

  /displays/{DisplayId}/campaign-assignments:
    get:
      summary: List campaign assignments for display
      security:
        - BearerAuth: []
        - ApiKeyAuth: []
      parameters:
        - name: DisplayId
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  value:
                    type: array
                    items:
                      $ref: '#/components/schemas/DisplayCampaign'
    post:
      summary: Create campaign assignment for display
      security:
        - BearerAuth: []
        - ApiKeyAuth: []
      parameters:
        - name: DisplayId
          in: path
          required: true
          schema:
            type: integer
        - name: Idempotency-Key
          in: header
          required: false
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/DisplayCampaign'
      responses:
        '201':
          description: Created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DisplayCampaign'

  /campaign-assignments/{Id}:
    put:
      summary: Update campaign assignment
      security:
        - BearerAuth: []
        - ApiKeyAuth: []
      parameters:
        - name: Id
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/DisplayCampaign'
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DisplayCampaign'
    delete:
      summary: Delete campaign assignment
      security:
        - BearerAuth: []
        - ApiKeyAuth: []
      parameters:
        - name: Id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '204':
          description: No Content

  /media-files/upload-url:
    post:
      summary: Get presigned upload URL
      security:
        - BearerAuth: []
        - ApiKeyAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UploadUrlRequest'
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UploadUrlResponse'

  /organizations/{OrganizationId}/media-files:
    get:
      summary: List media files for organization
      security:
        - BearerAuth: []
        - ApiKeyAuth: []
      parameters:
        - name: OrganizationId
          in: path
          required: true
          schema: { type: integer }
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  value:
                    type: array
                    items: { $ref: '#/components/schemas/MediaFile' }
    post:
      summary: Create media metadata (direct)
      security:
        - BearerAuth: []
        - ApiKeyAuth: []
      parameters:
        - name: OrganizationId
          in: path
          required: true
          schema: { type: integer }
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: '#/components/schemas/MediaFileCreate' }
      responses:
        '201':
          description: Created
          content:
            application/json:
              schema: { $ref: '#/components/schemas/MediaFile' }

  /media-files/{Id}:
    get:
      summary: Get media file by id
      security:
        - BearerAuth: []
        - ApiKeyAuth: []
      parameters:
        - name: Id
          in: path
          required: true
          schema: { type: integer }
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema: { $ref: '#/components/schemas/MediaFile' }
    put:
      summary: Update media file
      security:
        - BearerAuth: []
        - ApiKeyAuth: []
      parameters:
        - name: Id
          in: path
          required: true
          schema: { type: integer }
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: '#/components/schemas/MediaFileUpdate' }
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema: { $ref: '#/components/schemas/MediaFile' }
    delete:
      summary: Delete media file
      security:
        - BearerAuth: []
        - ApiKeyAuth: []
      parameters:
        - name: Id
          in: path
          required: true
          schema: { type: integer }
      responses:
        '204': { description: No Content }

  /media-files/{MediaFileId}/download-url:
    get:
      summary: Get presigned download URL
      security:
        - BearerAuth: []
        - ApiKeyAuth: []
      parameters:
        - name: MediaFileId
          in: path
          required: true
          schema: { type: integer }
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DownloadUrlResponse'

  /displays/{Id}/current-playing:
    get:
      summary: Get current playing media on display
      security:
        - BearerAuth: []
        - ApiKeyAuth: []
      parameters:
        - name: Id
          in: path
          required: true
          schema: { type: integer }
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  DisplayId: { type: integer }
                  CampaignId: { type: integer }
                  MediaFileId: { type: integer }
                  PlaybackTimestamp: { type: string, format: date-time }
                  StartedAt: { type: string, format: date-time }
                  MediaFileName: { type: string }
                  MediaFileType: { type: string }
                  CampaignName: { type: string }
        '404': { description: No playback yet }

  /displays/{Id}/set-primary:
    post:
      summary: Set primary campaign for display
      security:
        - BearerAuth: []
        - ApiKeyAuth: []
      parameters:
        - name: Id
          in: path
          required: true
          schema: { type: integer }
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                CampaignId: { type: integer }
              required: [CampaignId]
      responses:
        '204': { description: No Content }

  /analytics/plays:
    get:
      summary: List playback logs with filters
      security:
        - BearerAuth: []
        - ApiKeyAuth: []
      parameters:
        - in: query
          name: organizationId
          schema: { type: integer }
        - in: query
          name: displayId
          schema: { type: integer }
        - in: query
          name: campaignId
          schema: { type: integer }
        - in: query
          name: mediaFileId
          schema: { type: integer }
        - in: query
          name: from
          schema: { type: string, format: date-time }
        - in: query
          name: to
          schema: { type: string, format: date-time }
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  value:
                    type: array
                    items:
                      type: object
                      properties:
                        DisplayId: { type: integer }
                        CampaignId: { type: integer }
                        MediaFileId: { type: integer }
                        PlaybackTimestamp: { type: string, format: date-time }
                        DisplayName: { type: string }
                        CampaignName: { type: string }
                        MediaFileName: { type: string }

  /analytics/summary/media:
    get:
      summary: Playback summary grouped by media file
      security:
        - BearerAuth: []
        - ApiKeyAuth: []
      parameters:
        - in: query
          name: organizationId
          schema: { type: integer }
        - in: query
          name: from
          schema: { type: string, format: date-time }
        - in: query
          name: to
          schema: { type: string, format: date-time }
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  value:
                    type: array
                    items:
                      type: object
                      properties:
                        MediaFileId: { type: integer }
                        MediaFileName: { type: string }
                        Plays: { type: integer }

  /analytics/summary/campaigns:
    get:
      summary: Playback summary grouped by campaign
      security:
        - BearerAuth: []
        - ApiKeyAuth: []
      parameters:
        - in: query
          name: organizationId
          schema: { type: integer }
        - in: query
          name: from
          schema: { type: string, format: date-time }
        - in: query
          name: to
          schema: { type: string, format: date-time }
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  value:
                    type: array
                    items:
                      type: object
                      properties:
                        CampaignId: { type: integer }
                        CampaignName: { type: string }
                        Plays: { type: integer }

  /device/provisioning/token:
    post:
      summary: Create a short-lived provisioning token for pairing
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/DeviceProvisioningTokenRequest'
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DeviceProvisioningTokenResponse'

  /organizations/{OrganizationId}/displays/claim:
    post:
      summary: Claim a provisioning token and create a display under an organization
      security:
        - BearerAuth: []
      parameters:
        - name: OrganizationId
          in: path
          required: true
          schema: { type: integer }
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/DisplayClaimRequest'
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DisplayClaimResponse'

  /device/config:
    post:
      summary: Get device configuration
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/DeviceConfigRequest'
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DeviceConfigResponse'

  /device/logs:
    post:
      summary: Submit device log entry
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/DeviceLogRequest'
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DeviceLogResponse'

  /playback-logs:
    post:
      summary: Submit playback log
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PlaybackLogRequest'
      responses:
        '204':
          description: No Content

components:
  schemas:
    MediaFile:
      type: object
      properties:
        Id: { type: integer }
        OrganizationId: { type: integer }
        FileName: { type: string }
        FileType: { type: string }
        Orientation: { type: string, description: "Landscape or Portrait" }
        StorageURL: { type: string }
        CreatedAt: { type: string, format: date-time }
        UpdatedAt: { type: string, format: date-time }
    MediaFileCreate:
      type: object
      properties:
        FileName: { type: string }
        FileType: { type: string }
        StorageURL: { type: string }
      required: [FileName, StorageURL]
    MediaFileUpdate:
      type: object
      properties:
        FileName: { type: string }
        FileType: { type: string }
        StorageURL: { type: string }
    Organization:
      type: object
      properties:
        Id: { type: integer }
        Name: { type: string }
        CreatedAt: { type: string, format: date-time }
        UpdatedAt: { type: string, format: date-time }
    OrganizationCreate:
      type: object
      properties:
        Name: { type: string }
      required: [Name]
    Display:
      type: object
      properties:
        Id: { type: integer }
        OrganizationId: { type: integer }
        Name: { type: string }
        Orientation: { type: string }
        LastSeen: { type: string, format: date-time }
        CurrentStatus: { type: string }
        ProvisioningToken: { type: string }
        CreatedAt: { type: string, format: date-time }
        UpdatedAt: { type: string, format: date-time }
    DisplayCreate:
      type: object
      properties:
        Name: { type: string }
        Orientation: { type: string }
      required: [Name]
    DisplayCampaign:
      type: object
      properties:
        Id: { type: integer }
        DisplayId: { type: integer }
        CampaignId: { type: integer }
        IsPrimary: { type: boolean }
    Campaign:
      type: object
      properties:
        Id: { type: integer }
        OrganizationId: { type: integer }
        Name: { type: string }
        Orientation: { type: string }
        CreatedAt: { type: string, format: date-time }
        UpdatedAt: { type: string, format: date-time }
    CampaignCreate:
      type: object
      properties:
        Name: { type: string }
        Orientation: { type: string }
      required: [Name]
    CampaignItem:
      type: object
      properties:
        Id: { type: integer }
        CampaignId: { type: integer }
        MediaFileId: { type: integer }
        DisplayOrder: { type: integer }
        Duration: { type: integer }
    CampaignItemCreate:
      type: object
      properties:
        MediaFileId: { type: integer }
        DisplayOrder: { type: integer }
        Duration: { type: integer }
      required: [MediaFileId]

    Schedule:
      type: object
      properties:
        Id: { type: integer }
        CampaignId: { type: integer }
        StartTime: { type: string, format: date-time, nullable: true }
        EndTime: { type: string, format: date-time, nullable: true }
        RecurringPattern:
          type: string
          nullable: true
          description: |
            Optional recurrence definition. Stored verbatim.

            Recommended format (JSON):
            {"tz":"UTC","daysOfWeek":[1,2,3,4,5],"startLocal":"09:00","endLocal":"17:00"}

            daysOfWeek: 0=Sun..6=Sat
    ScheduleUpsert:
      type: object
      properties:
        StartTime: { type: string, format: date-time, nullable: true }
        EndTime: { type: string, format: date-time, nullable: true }
        RecurringPattern: { type: string, nullable: true }
    Subscription:
      type: object
      properties:
        SubscriptionID: { type: integer }
        OrganizationID: { type: integer }
        PlanID: { type: integer }
        Status: { type: string }
        CurrentPeriodEnd: { type: string, format: date-time }
    Plan:
      type: object
      properties:
        PlanID: { type: integer }
        Name: { type: string }
        Price: { type: number }
        MaxDisplays: { type: integer }
        MaxCampaigns: { type: integer }
        MaxMediaStorageGB: { type: integer }
        IsActive: { type: boolean }
    AuthLoginRequest:
      type: object
      properties:
        Email: { type: string }
        Password: { type: string }
    AuthRegisterRequest:
      type: object
      properties:
        Email: { type: string }
        Password: { type: string }
        OrganizationName: { type: string }
    AuthRefreshRequest:
      type: object
      properties:
        RefreshToken: { type: string }
      required: [RefreshToken]
    AuthLogoutRequest:
      type: object
      properties:
        RefreshToken: { type: string }
      required: [RefreshToken]
    User:
      type: object
      properties:
        Id: { type: integer }
        OrganizationId: { type: integer }
        Email: { type: string }
        PasswordHash: { type: string }
        Role: { type: string }
        CreatedAt: { type: string, format: date-time }
        UpdatedAt: { type: string, format: date-time }
    AuthResponse:
      type: object
      properties:
        Token: { type: string }
        RefreshToken: { type: string }
        User: { $ref: '#/components/schemas/User' }
        Success: { type: boolean }
        Message: { type: string }

    ApiKeyCreateRequest:
      type: object
      properties:
        Name: { type: string }
        Scopes: { type: string, description: "Space-separated scopes" }
        ExpiresAt: { type: string, format: date-time, nullable: true }
      required: [Name, Scopes]
    ApiKeyCreateResponse:
      type: object
      properties:
        ApiKeyId: { type: integer, format: int64 }
        ApiKey: { type: string, description: "Only returned once" }
        Name: { type: string }
        Scopes: { type: string }
        ExpiresAt: { type: string, format: date-time, nullable: true }
    ApiKeyListItem:
      type: object
      properties:
        ApiKeyId: { type: integer, format: int64 }
        Name: { type: string }
        Scopes: { type: string }
        CreatedAt: { type: string, format: date-time }
        LastUsedAt: { type: string, format: date-time, nullable: true }
        ExpiresAt: { type: string, format: date-time, nullable: true }
        RevokedAt: { type: string, format: date-time, nullable: true }

    WebhookCreateRequest:
      type: object
      properties:
        Url: { type: string }
        Events: { type: string, description: "Comma-separated events" }
        Secret: { type: string, description: "Optional; generated if omitted" }
      required: [Url, Events]
    Webhook:
      type: object
      properties:
        WebhookId: { type: integer, format: int64 }
        Url: { type: string }
        Events: { type: string }
        IsActive: { type: boolean }
    WebhookCreateResponse:
      allOf:
        - $ref: '#/components/schemas/Webhook'
        - type: object
          properties:
            Secret: { type: string }

    AuditLogEntry:
      type: object
      properties:
        AuditLogId: { type: integer, format: int64 }
        CreatedAt: { type: string, format: date-time }
        UserId: { type: integer, nullable: true }
        Action: { type: string }
        ObjectType: { type: string }
        ObjectId: { type: string }
        Details: { type: string }
        RequestId: { type: string }
        IpAddress: { type: string }
        UserAgent: { type: string }
    AuditLogListResponse:
      type: object
      properties:
        Items:
          type: array
          items:
            $ref: '#/components/schemas/AuditLogEntry'
        NextBeforeId: { type: integer, format: int64, nullable: true }
    UploadUrlRequest:
      type: object
      properties:
        OrganizationId: { type: integer }
        FileName: { type: string }
        FileType: { type: string }
        Orientation: { type: string, description: "Landscape or Portrait" }
        ContentLength: { type: integer }
    UploadUrlResponse:
      type: object
      properties:
        MediaFileId: { type: integer }
        UploadUrl: { type: string }
        StorageKey: { type: string }
        Success: { type: boolean }
        Message: { type: string }
    DownloadUrlResponse:
      type: object
      properties:
        DownloadUrl: { type: string }
        Success: { type: boolean }
        Message: { type: string }
    DeviceProvisioningTokenRequest:
      type: object
      properties:
        HardwareId: { type: string }
      required: [HardwareId]
    DeviceProvisioningTokenResponse:
      type: object
      properties:
        ProvisioningToken: { type: string }
        ExpiresInSeconds: { type: integer }
        QrCodeData: { type: string }
        Instructions: { type: string }
    DisplayClaimRequest:
      type: object
      properties:
        ProvisioningToken: { type: string }
        Name: { type: string }
        Orientation: { type: string, description: "Landscape or Portrait" }
      required: [ProvisioningToken]
    DisplayClaimResponse:
      type: object
      properties:
        Id: { type: integer }
        Name: { type: string }
        Orientation: { type: string }
    DeviceConfigRequest:
      type: object
      properties:
        ProvisioningToken: { type: string }
    DeviceConfigResponse:
      type: object
      properties:
        Device: { $ref: '#/components/schemas/Display' }
        Campaigns:
          type: array
          items: { $ref: '#/components/schemas/Campaign' }
        Success: { type: boolean }
        Message: { type: string }
    DeviceLogRequest:
      type: object
      properties:
        DisplayId: { type: integer }
        LogType: { type: string }
        Message: { type: string }
        Timestamp: { type: string, format: date-time }
    DeviceLogResponse:
      type: object
      properties:
        Success: { type: boolean }
        Message: { type: string }
    PlaybackLogRequest:
      type: object
      properties:
        DisplayId: { type: integer }
        MediaFileId: { type: integer }
        CampaignId: { type: integer }
        PlaybackTimestamp: { type: string, format: date-time }
      required: [DisplayId, MediaFileId, CampaignId, PlaybackTimestamp]
  securitySchemes:
    BearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
    ApiKeyAuth:
      type: apiKey
      in: header
      name: X-Api-Key